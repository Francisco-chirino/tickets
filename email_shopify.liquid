<!--
  COPIA Y PEGA ESTO EN SHOPIFY
  Ruta: ConfiguraciÃ³n > Notificaciones > ConfirmaciÃ³n de pedido
  PÃ©galo donde quieras que aparezcan los cÃ³digos QR (ej. despuÃ©s de la lista de items).

  NOTA: Recuerda reemplazar 'https://TU-APP.onrender.com' con tu URL real.
-->

{% if line_items %}
  <br>
  <table class="row section">
    <tr>
      <td class="section__cell">
        <center>
          <h2 style="margin-bottom: 15px;">ğŸŸï¸ Tus Entradas para el Evento</h2>
          <p style="margin-bottom: 25px;">Presenta estos cÃ³digos QR en la entrada para acceder.</p>
        </center>

        {% for item in line_items %}
          <!-- Filtro: Solo mostrar si el producto tiene SKU (asumiendo que es ticket) -->
          {% if item.sku != blank %}
            <div style="border: 2px dashed #ccc; padding: 20px; margin-bottom: 20px; border-radius: 8px; background-color: #fafafa;">
              <h3 style="margin-top: 0;">{{ item.title }}</h3>
              <p>Cantidad: {{ item.quantity }}</p>
              <hr style="border: 0; border-top: 1px solid #ddd; margin: 15px 0;">

              <!-- Bucle para generar un QR por cada unidad comprada -->
              {% for i in (1..item.quantity) %}
                {% assign ticket_idx = i %}

                <!-- ConstrucciÃ³n del ID: TICKET-{Orden}-{Item}-{Indice} -->
                {% assign ticket_id = "TICKET-" | append: order.id | append: "-" | append: item.id | append: "-" | append: ticket_idx %}

                <!-- ConstrucciÃ³n de la URL del QR -->
                <!-- Replace TU-APP.onrender.com with your actual domain -->
                {% assign qr_url = "https://tickets-e810.onrender.com/generar_qr/" | append: ticket_id %}

                <div style="display: inline-block; margin: 10px; text-align: center;">
                  <p style="font-weight: bold; margin-bottom: 5px; font-size: 12px;">Entrada #{{ i }}</p>
                  <img src="{{ qr_url }}" alt="QR Ticket" width="150" height="150" style="border: 1px solid #eee;">
                  <p style="font-size: 10px; color: #888;">{{ ticket_id }}</p>
                </div>
              {% endfor %}
            </div>
          {% endif %}
        {% endfor %}
      </td>
    </tr>
  </table>
{% endif %}